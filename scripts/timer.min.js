angular.module("timer",[]).directive("timer",["$compile",function(t){return{restrict:"E",replace:!1,scope:{interval:"=interval",startTimeAttr:"=startTime",endTimeAttr:"=endTime",countdownattr:"=countdown",finishCallback:"&finishCallback",autoStart:"&autoStart",language:"@?",fallback:"@?",maxTimeUnit:"="},controller:["$scope","$element","$attrs",function(n,e,s){function i(){n.timeoutId&&clearTimeout(n.timeoutId)}function o(){n.seconds=Math.floor(n.millis/1e3%60),n.minutes=Math.floor(n.millis/6e4%60),n.hours=Math.floor(n.millis/36e5%24),n.days=Math.floor(n.millis/36e5/24),n.secondsS=1===n.seconds?"":"s",n.minutesS=1===n.minutes?"":"s",n.hoursS=1===n.hours?"":"s",n.daysS=1===n.days?"":"s",n.monthsS=1===n.months?"":"s",n.yearsS=1===n.years?"":"s",n.sseconds=n.seconds<10?"0"+n.seconds:n.seconds,n.mminutes=n.minutes<10?"0"+n.minutes:n.minutes,n.hhours=n.hours<10?"0"+n.hours:n.hours,n.ddays=n.days<10?"0"+n.days:n.days,n.mmonths=n.months<10?"0"+n.months:n.months,n.yyears=n.years<10?"0"+n.years:n.years}n.autoStart=s.autoStart||s.autostart,e.append(0===e.html().trim().length?t("<span>{{millis}}</span>")(n):t(e.contents())(n)),n.startTime=null,n.endTime=null,n.timeoutId=null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>=0?parseInt(n.countdownattr,10):void 0,n.isRunning=!1,n.$on("timer-start",function(){n.start()}),n.$on("timer-resume",function(){n.resume()}),n.$on("timer-stop",function(){n.stop()}),n.start=e[0].start=function(){n.startTime=n.startTimeAttr?new Date(n.startTimeAttr):new Date,n.endTime=n.endTimeAttr?new Date(n.endTimeAttr):null,n.countdown=n.countdownattr&&parseInt(n.countdownattr,10)>0?parseInt(n.countdownattr,10):void 0,i(),a()},n.resume=e[0].resume=function(){i(),n.countdownattr&&(n.countdown+=1),n.startTime=new Date-(n.stoppedTime-n.startTime),a()},n.stop=n.pause=e[0].stop=e[0].pause=function(){n.stoppedTime=new Date,i(),n.$emit("timer-stopped",{millis:n.millis,seconds:n.seconds,minutes:n.minutes,hours:n.hours,days:n.days}),n.timeoutId=null},e.bind("$destroy",function(){i()}),n.millis=n.countdownattr?1e3*n.countdownattr:0,o();var a=function(){n.millis=new Date-n.startTime;var t=n.millis%1e3;return n.endTimeAttr&&(n.millis=n.endTime-new Date,t=n.interval-n.millis%1e3),n.countdownattr&&(n.millis=1e3*n.countdown),n.millis<0?(n.stop(),n.millis=0,void o()):n.millis<0?(n.stop(),n.millis=0,o(),void(n.finishCallback&&n.$eval(n.finishCallback))):(o(),n.timeoutId=setTimeout(function(){a(),n.$digest()},n.interval-t),n.$emit("timer-tick",{timeoutId:n.timeoutId,millis:n.millis}),void(n.countdown>0?n.countdown--:n.countdown<=0&&(n.stop(),n.finishCallback&&n.$eval(n.finishCallback))))};(void 0===n.autoStart||n.autoStart===!0)&&n.start()}]}}]);